## 一、Innodb的索引模型

InnoDB使用B+树索引模型，每个索引对应一棵B+树

**主键索引**的叶子节点存的是整行数据。也被称为聚簇索引。

**非主键索引**的叶子节点是主键的值。被称为二级索引。

从二级索引树回到**主键索引树**搜索的过程，叫做**回表**。

**覆盖索引**：

使用覆盖索引不需要回表查询，可以减少树的搜索次数，显著提升查询性能。



在建立联合索引的时候，如何安排索引内的字段顺序：

**第一原则**，如果通过调整顺序，可以少维护一个索引，那么优先考虑



**索引下推**：

在索引遍历的过程中，对索引包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。



## 二、普通索引、唯一索引的更新过程

当更新一个数据页时，如果数据页在内存中就直接更新，如果这个数据页还没在内存中，InnoDB 会将这些更新操作缓存在 change buffer 中，就不需要从磁盘中读入这个数据页了。在下次查询需要访问这个数据页的时候，将数据页读入内存，然后执行 change buffer 中与这个页有关的操作。减少读磁盘

**但唯一索引更新不能使用change buffer**

唯一索引更新要判断这个操作是不是违反唯一性约束。

**写多读少**的业务change buffer使用效果最好



## 三、Mysql为什么有时候选错索引

选择索引是优化器的工作，优化器会根据扫描行数、是否使用临时表、排序等进行综合判断。

一个索引上不同的值个数越多（基数），索引的区分度就越好。

**索引的基数**计算是**采样统计**



## 四、给字符串加索引

字符串长度较长时，可以考虑前缀索引